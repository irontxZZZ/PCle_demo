# PCle_demo
---
## 项目环境
* **操作系统:** Ubuntu 22.04 LTS

* **构建工具:** build-essential

* **内核依赖:** linux-headers-$(uname -r)

* **仿真平台:** QEMU
  
---

## 实现内容
本项目实现了一个基础的Linux内核PCIe驱动模块。该驱动可以：

* 注册自身以响应特定的Vendor ID和Device ID。

* 当匹配的PCIe设备被内核发现时，执行probe函数。

* 在probe函数中，完成对设备BAR0空间的内存映射(ioremap)。

通过映射后的虚拟地址，对模拟的设备寄存器进行读(ioread32)和写(iowrite32)操作。

---

## 验证方法
本项目提供两种验证层次：

#### 无硬件验证：

* 直接在主机系统加载驱动模块(insmod)。

* 通过dmesg观察，由于系统中不存在匹配的物理硬件，驱动的probe函数不会被内核调用。以此验证驱动与设备的匹配机制。

#### QEMU仿真验证：

* 启动QEMU虚拟机，并使用-device edu参数附加一个虚拟PCIe设备（ID 1234:11e8）。

* 在虚拟机内部加载经过适配的驱动模块。

* 通过dmesg观察，可见probe函数被成功调用，并打印出与虚拟设备寄存器交互的完整日志，完成端到端的闭环验证。
